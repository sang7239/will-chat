{"ast":null,"code":"var _jsxFileName = \"/Users/willhwang/go/src/github.com/will-slack/apiclient/client/src/components/MessageList/index.js\";\nimport React, { useEffect, useState, useContext, Component } from 'react';\nimport Compose from '../Compose';\nimport Toolbar from '../Toolbar';\nimport ToolbarButton from '../ToolbarButton';\nimport Message from '../Message';\nimport moment from 'moment';\nimport ChannelContext from '../../context/ChannelContext';\nimport './MessageList.css';\nimport axios from 'axios';\nimport AuthContext from '../../context/AuthContext';\nimport propTypes from 'prop-types';\nimport { store } from 'react-notifications-component';\nexport default class MessageList extends Component {\n  constructor(props) {\n    super(props);\n    this.ws = new WebSocket(\"wss://localhost:4000/v1/websocket\");\n\n    this.scrollToBottom = () => {\n      this.messagesEnd.scrollIntoView({\n        behavior: \"smooth\"\n      });\n    };\n\n    this.update = message => {\n      const {\n        auth\n      } = this.context;\n      axios.get('https://localhost:4000/v1/channels/' + this.state.currentChannel, {\n        headers: {\n          \"Authorization\": auth.token\n        }\n      }).then(response => {\n        let msgs = response.data.map(results => {\n          return {\n            author: results.creatorID,\n            message: results.body,\n            timestamp: results.createdAt,\n            firstName: results.firstname,\n            lastName: results.lastname\n          };\n        });\n        this.setState({\n          messages: msgs\n        });\n      }).then(this.ws.send(message));\n    };\n\n    this.deleteChannel = e => {\n      const {\n        auth\n      } = this.context;\n      e.preventDefault();\n      axios.delete(\"https://localhost:4000/v1/channels/\" + this.state.currentChannel, {\n        headers: {\n          Authorization: auth.token\n        }\n      }).then(result => {\n        if (result.status == 200) {\n          window.location.reload(false);\n        }\n      }).catch(e => {\n        console.log(e);\n      });\n    };\n\n    this.editChannel = e => {\n      const {\n        auth\n      } = this.context;\n      e.preventDefault();\n      axios({\n        method: 'PATCH',\n        url: \"https://localhost:4000/v1/channels/\" + this.state.currentChannel,\n        headers: {\n          Authorization: auth.token\n        },\n        data: {\n          name: this.channelName.value,\n          description: this.description.value\n        }\n      }).then(result => {\n        if (result.status == 200) {\n          window.location.reload(false);\n        }\n      }).catch(e => {\n        console.log(e);\n      });\n    };\n\n    this.resetMessage = () => {\n      this.setState({\n        message: \"\",\n        color: \"\"\n      });\n    };\n\n    this.addUserToChannel = e => {\n      const {\n        auth\n      } = this.context;\n      e.preventDefault();\n      axios.get('https://localhost:4000/v1/users/' + this.userName.value, {\n        headers: {\n          \"Authorization\": auth.token\n        }\n      }).then(response => {\n        axios({\n          method: 'LINK',\n          url: \"https://localhost:4000/v1/channels/\" + this.state.currentChannel,\n          headers: {\n            Authorization: auth.token,\n            Link: response.data\n          }\n        }).then(result => {\n          if (result.status == 200) {\n            this.setState({\n              message: result.data,\n              color: \"green\"\n            });\n          }\n        }).catch(e => {\n          this.setState({\n            message: e.message,\n            color: \"red\"\n          });\n        });\n      });\n    };\n\n    this.removeUserFromChannel = e => {\n      const {\n        auth\n      } = this.context;\n      e.preventDefault();\n      axios.get('https://localhost:4000/v1/users/' + this.removeName.value, {\n        headers: {\n          \"Authorization\": auth.token\n        }\n      }).then(response => {\n        axios({\n          method: 'UNLINK',\n          url: \"https://localhost:4000/v1/channels/\" + this.state.currentChannel,\n          headers: {\n            Authorization: auth.token,\n            Link: response.data\n          }\n        }).then(result => {\n          console.log(result);\n\n          if (result.status == 200) {\n            this.setState({\n              message: result.data,\n              color: \"green\"\n            });\n          }\n        }).catch(e => {\n          this.setState({\n            message: e.message,\n            color: \"red\"\n          });\n          console.log(e);\n        });\n      });\n    };\n\n    this.renderMessages = messages => {\n      let MY_USER_ID = this.props.currentUserID;\n      let i = 0;\n      let messageCount = messages.length;\n      let tempMessages = [];\n\n      while (i < messageCount) {\n        let previous = messages[i - 1];\n        let current = messages[i];\n        let next = messages[i + 1];\n        let isMine = current.author === MY_USER_ID;\n        let currentMoment = moment(current.timestamp);\n        let prevBySameAuthor = false;\n        let nextBySameAuthor = false;\n        let startsSequence = true;\n        let endsSequence = true;\n        let showTimestamp = true;\n\n        if (previous) {\n          let previousMoment = moment(previous.timestamp);\n          let previousDuration = moment.duration(currentMoment.diff(previousMoment));\n          prevBySameAuthor = previous.author === current.author;\n\n          if (prevBySameAuthor && previousDuration.as('hours') < 1) {\n            startsSequence = false;\n          }\n\n          if (previousDuration.as('hours') < 1) {\n            showTimestamp = false;\n          }\n        }\n\n        if (next) {\n          let nextMoment = moment(next.timestamp);\n          let nextDuration = moment.duration(nextMoment.diff(currentMoment));\n          nextBySameAuthor = next.author === current.author;\n\n          if (nextBySameAuthor && nextDuration.as('hours') < 1) {\n            endsSequence = false;\n          }\n        }\n\n        tempMessages.push( /*#__PURE__*/React.createElement(Message, {\n          key: i,\n          isMine: isMine,\n          startsSequence: startsSequence,\n          endsSequence: endsSequence,\n          showTimestamp: showTimestamp,\n          data: current,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 272,\n            columnNumber: 9\n          }\n        })); // Proceed to the next message.\n\n        i += 1;\n      }\n\n      return tempMessages;\n    };\n\n    this.state = {\n      currentChannel: this.props.currentChannel,\n      currentChannelName: this.props.currentChannelName,\n      currentUserID: this.props.currentUserID,\n      isChannelCreator: this.props.isChannelCreator,\n      isPrivateChannel: this.props.isPrivateChannel,\n      messages: [],\n      message: \"\",\n      color: \"red\"\n    };\n    this.update = this.update.bind(this);\n  }\n\n  componentDidMount() {\n    const auth = this.context;\n\n    this.ws.onopen = () => {\n      // on connecting, do nothing but log it to the console\n      console.log('connected');\n    };\n\n    this.ws.onmessage = event => {\n      // on receiving a message, add it to the list of messages\n      let data = JSON.parse(event.data).data;\n      store.addNotification({\n        title: \"Wonderful!\",\n        message: \"teodosii@react-notifications-component\",\n        type: \"success\",\n        insert: \"top\",\n        container: \"top-right\",\n        animationIn: [\"animated\", \"fadeIn\"],\n        animationOut: [\"animated\", \"fadeOut\"],\n        dismiss: {\n          duration: 5000,\n          onScreen: true\n        }\n      });\n      let msg = {\n        author: data.creatorID,\n        message: data.body,\n        timestamp: data.createdAt,\n        firstName: data.firstname,\n        lastName: data.lastname\n      };\n      console.log(msg);\n      this.setState(previousState => ({\n        messages: [...previousState.messages, msg]\n      }));\n    };\n\n    this.ws.onclose = () => {\n      console.log('disconnected'); // automatically try to reconnect on connection loss\n\n      this.setState({\n        ws: new WebSocket(\"wss://localhost:4000/v1/websocket\")\n      });\n    };\n\n    this.scrollToBottom();\n  }\n\n  componentDidUpdate() {\n    this.scrollToBottom();\n  }\n\n  componentWillReceiveProps(newProps) {\n    const {\n      auth\n    } = this.context;\n    axios.get('https://localhost:4000/v1/channels/' + newProps.currentChannel, {\n      headers: {\n        \"Authorization\": auth.token\n      }\n    }).then(response => {\n      console.log(response);\n      let msgs = response.data.map(results => {\n        return {\n          author: results.creatorID,\n          message: results.body,\n          timestamp: results.createdAt,\n          firstName: results.firstname,\n          lastName: results.lastname\n        };\n      });\n      this.setState({\n        messages: msgs\n      });\n    });\n    this.setState({\n      currentChannel: newProps.currentChannel\n    });\n  }\n\n  render() {\n    const channelExists = this.state.currentChannel != \"\";\n    const isCreator = this.props.isChannelCreator;\n    const isPrivateChannel = this.props.isPrivateChannel;\n    return /*#__PURE__*/React.createElement(\"div\", {\n      id: \"channel-header\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 292,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"message-list\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 293,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(Toolbar, {\n      title: this.props.currentChannelName,\n      rightItems: [/*#__PURE__*/React.createElement(ToolbarButton, {\n        key: \"info\",\n        icon: \"ion-ios-information-circle-outline\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 297,\n          columnNumber: 15\n        }\n      }), /*#__PURE__*/React.createElement(ToolbarButton, {\n        key: \"video\",\n        icon: \"ion-ios-videocam\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 298,\n          columnNumber: 15\n        }\n      }), /*#__PURE__*/React.createElement(ToolbarButton, {\n        key: \"phone\",\n        icon: \"ion-ios-call\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 299,\n          columnNumber: 15\n        }\n      })],\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 294,\n        columnNumber: 11\n      }\n    }), isCreator ? /*#__PURE__*/React.createElement(\"div\", {\n      id: \"controls\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 304,\n        columnNumber: 13\n      }\n    }, isPrivateChannel ? /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 306,\n        columnNumber: 19\n      }\n    }, /*#__PURE__*/React.createElement(\"svg\", {\n      xmlns: \"http://www.w3.org/2000/svg\",\n      width: \"50\",\n      height: \"50\",\n      viewBox: \"0 0 8 8\",\n      \"data-toggle\": \"modal\",\n      \"data-target\": \"#AddToChannel\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 307,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(\"path\", {\n      d: \"M3 0v3h-3v2h3v3h2v-3h3v-2h-3v-3h-2z\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 308,\n        columnNumber: 23\n      }\n    }), /*#__PURE__*/React.createElement(\"title\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 309,\n        columnNumber: 23\n      }\n    }, \"Add User to Channel\")), /*#__PURE__*/React.createElement(\"svg\", {\n      xmlns: \"http://www.w3.org/2000/svg\",\n      width: \"50\",\n      height: \"50\",\n      viewBox: \"0 0 8 8\",\n      \"data-toggle\": \"modal\",\n      \"data-target\": \"#removeFromChannel\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 311,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(\"path\", {\n      d: \"M0 0v2h8v-2h-8z\",\n      transform: \"translate(0 3)\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 312,\n        columnNumber: 23\n      }\n    }), /*#__PURE__*/React.createElement(\"title\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 313,\n        columnNumber: 23\n      }\n    }, \"Remove User from Channel\"))) : null, /*#__PURE__*/React.createElement(\"svg\", {\n      xmlns: \"http://www.w3.org/2000/svg\",\n      width: \"50\",\n      height: \"50\",\n      viewBox: \"0 0 8 8\",\n      \"data-toggle\": \"modal\",\n      \"data-target\": \"#EditChannel\",\n      \"data-whatever\": \"@mdo\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 318,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"path\", {\n      d: \"M3.5 0l-.5 1.19c-.1.03-.19.08-.28.13l-1.19-.5-.72.72.5 1.19c-.05.1-.09.18-.13.28l-1.19.5v1l1.19.5c.04.1.08.18.13.28l-.5 1.19.72.72 1.19-.5c.09.04.18.09.28.13l.5 1.19h1l.5-1.19c.09-.04.19-.08.28-.13l1.19.5.72-.72-.5-1.19c.04-.09.09-.19.13-.28l1.19-.5v-1l-1.19-.5c-.03-.09-.08-.19-.13-.28l.5-1.19-.72-.72-1.19.5c-.09-.04-.19-.09-.28-.13l-.5-1.19h-1zm.5 2.5c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5-1.5-.67-1.5-1.5.67-1.5 1.5-1.5z\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 319,\n        columnNumber: 19\n      }\n    }), /*#__PURE__*/React.createElement(\"title\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 320,\n        columnNumber: 19\n      }\n    }, \"Edit Channel\")), /*#__PURE__*/React.createElement(\"svg\", {\n      xmlns: \"http://www.w3.org/2000/svg\",\n      width: \"50\",\n      height: \"50\",\n      viewBox: \"0 0 8 8\",\n      \"data-toggle\": \"modal\",\n      \"data-target\": \"#deleteChannel\",\n      \"data-whatever\": \"@mdo\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 322,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"path\", {\n      d: \"M3 0c-.55 0-1 .45-1 1h-1c-.55 0-1 .45-1 1h7c0-.55-.45-1-1-1h-1c0-.55-.45-1-1-1h-1zm-2 3v4.81c0 .11.08.19.19.19h4.63c.11 0 .19-.08.19-.19v-4.81h-1v3.5c0 .28-.22.5-.5.5s-.5-.22-.5-.5v-3.5h-1v3.5c0 .28-.22.5-.5.5s-.5-.22-.5-.5v-3.5h-1z\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 323,\n        columnNumber: 19\n      }\n    }), /*#__PURE__*/React.createElement(\"title\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 324,\n        columnNumber: 19\n      }\n    }, \"Delete Channel\"))) : null, channelExists ? /*#__PURE__*/React.createElement(Compose, {\n      currentChannel: this.state.currentChannel,\n      update: message => {\n        this.update(message);\n      },\n      currentUserFirstName: this.props.currentUserFirstName,\n      currentUserLastName: this.props.currentUserLastName,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 331,\n        columnNumber: 15\n      }\n    }) : /*#__PURE__*/React.createElement(\"h1\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 336,\n        columnNumber: 15\n      }\n    }, \"Create or Join Channel\")), /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 339,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      class: \"signup-form\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 340,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      class: \"modal fade\",\n      id: \"EditChannel\",\n      tabindex: \"-1\",\n      role: \"dialog\",\n      \"aria-labelledby\": \"exampleModalLabel\",\n      \"aria-hidden\": \"true\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 341,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      class: \"modal-dialog\",\n      role: \"document\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 342,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"form\", {\n      class: \"form-horizontal\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 343,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      class: \"col-xs-8 col-xs-offset-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 344,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(\"h2\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 345,\n        columnNumber: 29\n      }\n    }, \"Edit Channel\")), /*#__PURE__*/React.createElement(\"div\", {\n      class: \"form-group\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 347,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      class: \"control-label col-xs-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 348,\n        columnNumber: 29\n      }\n    }, \"Channel Name\"), /*#__PURE__*/React.createElement(\"div\", {\n      class: \"col-xs-8\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 349,\n        columnNumber: 29\n      }\n    }, /*#__PURE__*/React.createElement(\"input\", {\n      type: \"text\",\n      class: \"form-control\",\n      name: \"edit_channel_name\",\n      required: \"required\",\n      placeholder: this.state.firstname,\n      ref: node => this.channelName = node,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 350,\n        columnNumber: 33\n      }\n    }))), /*#__PURE__*/React.createElement(\"div\", {\n      class: \"form-group\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 355,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      class: \"control-label col-xs-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 356,\n        columnNumber: 29\n      }\n    }, \"Description\"), /*#__PURE__*/React.createElement(\"div\", {\n      class: \"col-xs-8\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 357,\n        columnNumber: 29\n      }\n    }, /*#__PURE__*/React.createElement(\"input\", {\n      type: \"text\",\n      class: \"form-control\",\n      name: \"edit_channel_description\",\n      placeholder: this.state.lastname,\n      ref: node => this.description = node,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 358,\n        columnNumber: 33\n      }\n    }))), /*#__PURE__*/React.createElement(\"div\", {\n      class: \"form-group\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 366,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      class: \"col-xs-8 col-xs-offset-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 367,\n        columnNumber: 29\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      class: \"btn btn-primary btn-sm\",\n      onClick: e => {\n        this.editChannel(e);\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 368,\n        columnNumber: 33\n      }\n    }, \"Save\")), /*#__PURE__*/React.createElement(\"div\", {\n      class: \"col-xs-8 col-xs-offset-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 370,\n        columnNumber: 29\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      type: \"button\",\n      class: \"btn btn-primary btn-sm\",\n      \"data-dismiss\": \"modal\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 371,\n        columnNumber: 33\n      }\n    }, \"Close\"))))))), /*#__PURE__*/React.createElement(\"div\", {\n      class: \"signup-form\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 380,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      class: \"modal fade\",\n      id: \"deleteChannel\",\n      tabindex: \"-1\",\n      role: \"dialog\",\n      \"aria-labelledby\": \"exampleModalLabel\",\n      \"aria-hidden\": \"true\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 381,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      class: \"modal-dialog\",\n      role: \"document\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 382,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"form\", {\n      class: \"form-horizontal\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 383,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(\"h2\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 384,\n        columnNumber: 25\n      }\n    }, \"Are you sure you want to delete this channel?\"), /*#__PURE__*/React.createElement(\"div\", {\n      class: \"form-group\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 385,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      class: \"col-xs-8 col-xs-offset-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 386,\n        columnNumber: 29\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      class: \"btn btn-primary btn-sm\",\n      onClick: e => {\n        this.deleteChannel(e);\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 387,\n        columnNumber: 33\n      }\n    }, \"YES\")), /*#__PURE__*/React.createElement(\"div\", {\n      class: \"col-xs-8 col-xs-offset-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 389,\n        columnNumber: 29\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      type: \"button\",\n      class: \"btn btn-primary btn-sm\",\n      \"data-dismiss\": \"modal\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 390,\n        columnNumber: 33\n      }\n    }, \"NO\"))))))), /*#__PURE__*/React.createElement(\"div\", {\n      class: \"signup-form\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 399,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      class: \"modal fade\",\n      id: \"AddToChannel\",\n      tabindex: \"-1\",\n      role: \"dialog\",\n      \"aria-labelledby\": \"exampleModalLabel\",\n      \"aria-hidden\": \"true\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 400,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      class: \"modal-dialog\",\n      role: \"document\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 401,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"form\", {\n      class: \"form-horizontal\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 402,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      class: \"col-xs-8 col-xs-offset-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 403,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(\"h2\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 404,\n        columnNumber: 29\n      }\n    }, \"Add User to Channel\")), /*#__PURE__*/React.createElement(\"div\", {\n      class: \"form-group\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 406,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      class: \"control-label col-xs-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 407,\n        columnNumber: 29\n      }\n    }, \"Username\"), /*#__PURE__*/React.createElement(\"div\", {\n      class: \"col-xs-8\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 408,\n        columnNumber: 29\n      }\n    }, /*#__PURE__*/React.createElement(\"input\", {\n      type: \"text\",\n      class: \"form-control\",\n      name: \"edit_channel_name\",\n      required: \"required\",\n      placeholder: this.state.firstname,\n      ref: node => this.userName = node,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 409,\n        columnNumber: 33\n      }\n    }))), /*#__PURE__*/React.createElement(\"div\", {\n      id: \"add-response\",\n      class: \"text-center\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 414,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(\"p\", {\n      style: {\n        color: this.state.color\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 415,\n        columnNumber: 29\n      }\n    }, this.state.message)), /*#__PURE__*/React.createElement(\"div\", {\n      class: \"form-group\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 417,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      class: \"col-xs-8 col-xs-offset-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 418,\n        columnNumber: 29\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      class: \"btn btn-primary btn-sm\",\n      onClick: e => {\n        this.addUserToChannel(e);\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 419,\n        columnNumber: 33\n      }\n    }, \"Add\")), /*#__PURE__*/React.createElement(\"div\", {\n      class: \"col-xs-8 col-xs-offset-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 421,\n        columnNumber: 29\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      type: \"button\",\n      class: \"btn btn-primary btn-sm\",\n      \"data-dismiss\": \"modal\",\n      onClick: this.resetMessage,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 422,\n        columnNumber: 33\n      }\n    }, \"Close\"))))))), /*#__PURE__*/React.createElement(\"div\", {\n      class: \"signup-form\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 431,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      class: \"modal fade\",\n      id: \"removeFromChannel\",\n      tabindex: \"-1\",\n      role: \"dialog\",\n      \"aria-labelledby\": \"exampleModalLabel\",\n      \"aria-hidden\": \"true\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 432,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      class: \"modal-dialog\",\n      role: \"document\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 433,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"form\", {\n      class: \"form-horizontal\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 434,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      class: \"col-xs-8 col-xs-offset-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 435,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(\"h2\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 436,\n        columnNumber: 29\n      }\n    }, \"Remove User From Channel\")), /*#__PURE__*/React.createElement(\"div\", {\n      class: \"form-group\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 438,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      class: \"control-label col-xs-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 439,\n        columnNumber: 29\n      }\n    }, \"Username\"), /*#__PURE__*/React.createElement(\"div\", {\n      class: \"col-xs-8\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 440,\n        columnNumber: 29\n      }\n    }, /*#__PURE__*/React.createElement(\"input\", {\n      type: \"text\",\n      class: \"form-control\",\n      name: \"edit_channel_name\",\n      required: \"required\",\n      placeholder: this.state.firstname,\n      ref: node => this.removeName = node,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 441,\n        columnNumber: 33\n      }\n    }))), /*#__PURE__*/React.createElement(\"div\", {\n      id: \"remove-response\",\n      class: \"text-center\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 446,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(\"p\", {\n      style: {\n        color: this.state.color\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 447,\n        columnNumber: 29\n      }\n    }, this.state.message)), /*#__PURE__*/React.createElement(\"div\", {\n      class: \"form-group\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 449,\n        columnNumber: 25\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      class: \"col-xs-8 col-xs-offset-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 450,\n        columnNumber: 29\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      class: \"btn btn-primary btn-sm\",\n      onClick: e => {\n        this.removeUserFromChannel(e);\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 451,\n        columnNumber: 33\n      }\n    }, \"Remove\")), /*#__PURE__*/React.createElement(\"div\", {\n      class: \"col-xs-8 col-xs-offset-4\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 453,\n        columnNumber: 29\n      }\n    }, /*#__PURE__*/React.createElement(\"button\", {\n      type: \"button\",\n      class: \"btn btn-primary btn-sm\",\n      \"data-dismiss\": \"modal\",\n      onClick: this.resetMessage,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 454,\n        columnNumber: 33\n      }\n    }, \"Close\")))))))), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"message-list-container\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 464,\n        columnNumber: 9\n      }\n    }, this.renderMessages(this.state.messages)), /*#__PURE__*/React.createElement(\"div\", {\n      style: {\n        float: \"left\",\n        clear: \"both\"\n      },\n      ref: el => {\n        this.messagesEnd = el;\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 469,\n        columnNumber: 9\n      }\n    }));\n  }\n\n}\nMessageList.contextType = AuthContext;","map":{"version":3,"sources":["/Users/willhwang/go/src/github.com/will-slack/apiclient/client/src/components/MessageList/index.js"],"names":["React","useEffect","useState","useContext","Component","Compose","Toolbar","ToolbarButton","Message","moment","ChannelContext","axios","AuthContext","propTypes","store","MessageList","constructor","props","ws","WebSocket","scrollToBottom","messagesEnd","scrollIntoView","behavior","update","message","auth","context","get","state","currentChannel","headers","token","then","response","msgs","data","map","results","author","creatorID","body","timestamp","createdAt","firstName","firstname","lastName","lastname","setState","messages","send","deleteChannel","e","preventDefault","delete","Authorization","result","status","window","location","reload","catch","console","log","editChannel","method","url","name","channelName","value","description","resetMessage","color","addUserToChannel","userName","Link","removeUserFromChannel","removeName","renderMessages","MY_USER_ID","currentUserID","i","messageCount","length","tempMessages","previous","current","next","isMine","currentMoment","prevBySameAuthor","nextBySameAuthor","startsSequence","endsSequence","showTimestamp","previousMoment","previousDuration","duration","diff","as","nextMoment","nextDuration","push","currentChannelName","isChannelCreator","isPrivateChannel","bind","componentDidMount","onopen","onmessage","event","JSON","parse","addNotification","title","type","insert","container","animationIn","animationOut","dismiss","onScreen","msg","previousState","onclose","componentDidUpdate","componentWillReceiveProps","newProps","render","channelExists","isCreator","currentUserFirstName","currentUserLastName","node","float","clear","el","contextType"],"mappings":"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","sourcesContent":["import React, {useEffect, useState, useContext, Component} from 'react';\nimport Compose from '../Compose';\nimport Toolbar from '../Toolbar';\nimport ToolbarButton from '../ToolbarButton';\nimport Message from '../Message';\nimport moment from 'moment';\nimport ChannelContext from '../../context/ChannelContext'\nimport './MessageList.css';\nimport axios from 'axios';\nimport AuthContext from '../../context/AuthContext';\nimport propTypes from 'prop-types'\nimport {store} from 'react-notifications-component'\nexport default class MessageList extends Component {\n  static contextType = AuthContext\n  static prop\n  constructor(props) {\n    super(props);\n    this.state = {\n      currentChannel: this.props.currentChannel,\n      currentChannelName: this.props.currentChannelName,\n      currentUserID: this.props.currentUserID,\n      isChannelCreator: this.props.isChannelCreator,\n      isPrivateChannel: this.props.isPrivateChannel,\n      messages: [],\n      message: \"\",\n      color: \"red\",\n    }\n    this.update = this.update.bind(this);\n  }\n  ws = new WebSocket(\"wss://localhost:4000/v1/websocket\")\n  componentDidMount() {\n    const auth = this.context;\n    this.ws.onopen = () => {\n      // on connecting, do nothing but log it to the console\n      console.log('connected')\n    }\n\n    this.ws.onmessage = event => {\n      // on receiving a message, add it to the list of messages\n      let data = JSON.parse(event.data).data\n      store.addNotification({\n        title: \"Wonderful!\",\n        message: \"teodosii@react-notifications-component\",\n        type: \"success\",\n        insert: \"top\",\n        container: \"top-right\",\n        animationIn: [\"animated\", \"fadeIn\"],\n        animationOut: [\"animated\", \"fadeOut\"],\n        dismiss: {\n          duration: 5000,\n          onScreen: true\n        }\n      });\n      let msg = {\n        author: data.creatorID,\n        message: data.body,\n        timestamp: data.createdAt,\n        firstName: data.firstname,\n        lastName: data.lastname\n      }\n      console.log(msg);\n      this.setState(previousState => ({\n        messages: [...previousState.messages, msg]\n    }));\n    }\n\n    this.ws.onclose = () => {\n      console.log('disconnected')\n      // automatically try to reconnect on connection loss\n      this.setState({\n        ws: new WebSocket(\"wss://localhost:4000/v1/websocket\"),\n      })\n    }\n    this.scrollToBottom();\n  }\n  componentDidUpdate() {\n    this.scrollToBottom();\n  }\n\n  scrollToBottom = () => {\n    this.messagesEnd.scrollIntoView({ behavior: \"smooth\" });\n  }\n\n  componentWillReceiveProps(newProps) {\n    const {auth} = this.context\n    axios.get('https://localhost:4000/v1/channels/'+ newProps.currentChannel, \n    {\n      headers: {\n        \"Authorization\": auth.token\n      }\n    }\n    ).then(response => {\n        console.log(response);\n        let msgs = response.data.map(results => {\n          return {\n            author: results.creatorID,\n            message: results.body,\n            timestamp: results.createdAt,\n            firstName: results.firstname,\n            lastName: results.lastname\n          }\n        })\n        this.setState({messages: msgs});\n    });\n    this.setState({currentChannel: newProps.currentChannel});\n  }\n\n  update = (message) => {\n    const {auth} = this.context\n    axios.get('https://localhost:4000/v1/channels/'+ this.state.currentChannel, \n    {\n      headers: {\n        \"Authorization\": auth.token\n      }\n    }\n    ).then(response => {\n        let msgs = response.data.map(results => {\n          return {\n            author: results.creatorID,\n            message: results.body,\n            timestamp: results.createdAt,\n            firstName: results.firstname,\n            lastName: results.lastname\n          }\n        })\n        this.setState({messages: msgs});\n      }).then(\n        this.ws.send(message)\n      );\n  }\n  deleteChannel = (e) => {\n    const {auth} = this.context\n    e.preventDefault();\n    axios.delete(\"https://localhost:4000/v1/channels/\" + this.state.currentChannel, {\n        headers: {\n            Authorization: auth.token\n        }\n    }).then(result => {\n        if (result.status == 200) {\n            window.location.reload(false);\n        }\n    }).catch(e => {\n        console.log(e);\n    });\n  }\n\n  editChannel = (e) => {\n    const {auth} = this.context\n    e.preventDefault();\n    axios({\n        method: 'PATCH', \n        url: \"https://localhost:4000/v1/channels/\" + this.state.currentChannel,\n        headers: {\n            Authorization: auth.token\n        },\n        data: {\n            name: this.channelName.value,\n            description: this.description.value\n        }\n    }).then(result => {\n        if (result.status == 200) {\n            window.location.reload(false);\n        }\n    }).catch(e => {\n        console.log(e);\n    })\n  }\n\n  resetMessage = () => {\n    this.setState({message:\"\", color:\"\"});\n  }\n\n  addUserToChannel = (e) => {\n    const {auth} = this.context\n    e.preventDefault();\n    axios.get('https://localhost:4000/v1/users/'+ this.userName.value, \n    {\n      headers: {\n        \"Authorization\": auth.token\n      }\n    }\n    ).then(response => {\n      axios({\n        method: 'LINK', \n        url: \"https://localhost:4000/v1/channels/\" + this.state.currentChannel,\n        headers: {\n            Authorization: auth.token,\n            Link: response.data\n        },\n      }).then(result => {\n          if (result.status == 200) {\n              this.setState({message: result.data, color: \"green\"});\n          }\n      }).catch(e => {\n        this.setState({message: e.message, color: \"red\"});\n      })\n    });\n  }\n\n  removeUserFromChannel = (e) => {\n    const {auth} = this.context\n    e.preventDefault();\n    axios.get('https://localhost:4000/v1/users/'+ this.removeName.value, \n    {\n      headers: {\n        \"Authorization\": auth.token\n      }\n    }\n    ).then(response => {\n      axios({\n        method: 'UNLINK', \n        url: \"https://localhost:4000/v1/channels/\" + this.state.currentChannel,\n        headers: {\n            Authorization: auth.token,\n            Link: response.data\n        },\n      }).then(result => {\n          console.log(result);\n          if (result.status == 200) {\n            this.setState({message: result.data, color: \"green\"});\n          }\n      }).catch(e => {\n          this.setState({message: e.message, color: \"red\"});\n          console.log(e);\n      })\n    });\n  }\n\n  renderMessages = (messages) => {\n    let MY_USER_ID = this.props.currentUserID;\n    let i = 0;\n    let messageCount = messages.length;\n    let tempMessages = [];\n\n    while (i < messageCount) {\n      let previous = messages[i - 1];\n      let current = messages[i];\n      let next = messages[i + 1];\n      let isMine = current.author === MY_USER_ID;\n      let currentMoment = moment(current.timestamp);\n      let prevBySameAuthor = false;\n      let nextBySameAuthor = false;\n      let startsSequence = true;\n      let endsSequence = true;\n      let showTimestamp = true;\n\n      if (previous) {\n        let previousMoment = moment(previous.timestamp);\n        let previousDuration = moment.duration(currentMoment.diff(previousMoment));\n        prevBySameAuthor = previous.author === current.author;\n        \n        if (prevBySameAuthor && previousDuration.as('hours') < 1) {\n          startsSequence = false;\n        }\n\n        if (previousDuration.as('hours') < 1) {\n          showTimestamp = false;\n        }\n      }\n\n      if (next) {\n        let nextMoment = moment(next.timestamp);\n        let nextDuration = moment.duration(nextMoment.diff(currentMoment));\n        nextBySameAuthor = next.author === current.author;\n\n        if (nextBySameAuthor && nextDuration.as('hours') < 1) {\n          endsSequence = false;\n        }\n      }\n\n      tempMessages.push(\n        <Message\n          key={i}\n          isMine={isMine}\n          startsSequence={startsSequence}\n          endsSequence={endsSequence}\n          showTimestamp={showTimestamp}\n          data={current}\n        />\n      );\n\n      // Proceed to the next message.\n      i += 1;\n    }\n    return tempMessages;\n  }\n  render() {\n    const channelExists = this.state.currentChannel != \"\"\n    const isCreator = this.props.isChannelCreator\n    const isPrivateChannel = this.props.isPrivateChannel\n    return(        \n      <div id=\"channel-header\">\n        <div className=\"message-list\" >\n          <Toolbar\n            title={this.props.currentChannelName}\n            rightItems={[\n              <ToolbarButton key=\"info\" icon=\"ion-ios-information-circle-outline\" />,\n              <ToolbarButton key=\"video\" icon=\"ion-ios-videocam\" />,\n              <ToolbarButton key=\"phone\" icon=\"ion-ios-call\" />\n            ]}\n          />\n          {\n            isCreator ? \n            <div id=\"controls\">\n                {isPrivateChannel ?\n                  <div>\n                    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"50\" height=\"50\" viewBox=\"0 0 8 8\" data-toggle=\"modal\" data-target=\"#AddToChannel\">\n                      <path d=\"M3 0v3h-3v2h3v3h2v-3h3v-2h-3v-3h-2z\" />\n                      <title>Add User to Channel</title>\n                    </svg> \n                    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"50\" height=\"50\" viewBox=\"0 0 8 8\" data-toggle=\"modal\" data-target=\"#removeFromChannel\">\n                      <path d=\"M0 0v2h8v-2h-8z\" transform=\"translate(0 3)\" />\n                      <title>Remove User from Channel</title>\n                    </svg>\n                    </div>\n                : null\n                }\n                <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"50\" height=\"50\" viewBox=\"0 0 8 8\" data-toggle=\"modal\" data-target=\"#EditChannel\" data-whatever=\"@mdo\">\n                  <path d=\"M3.5 0l-.5 1.19c-.1.03-.19.08-.28.13l-1.19-.5-.72.72.5 1.19c-.05.1-.09.18-.13.28l-1.19.5v1l1.19.5c.04.1.08.18.13.28l-.5 1.19.72.72 1.19-.5c.09.04.18.09.28.13l.5 1.19h1l.5-1.19c.09-.04.19-.08.28-.13l1.19.5.72-.72-.5-1.19c.04-.09.09-.19.13-.28l1.19-.5v-1l-1.19-.5c-.03-.09-.08-.19-.13-.28l.5-1.19-.72-.72-1.19.5c-.09-.04-.19-.09-.28-.13l-.5-1.19h-1zm.5 2.5c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5-1.5-.67-1.5-1.5.67-1.5 1.5-1.5z\"/>\n                  <title>Edit Channel</title>\n                </svg>\n                <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"50\" height=\"50\" viewBox=\"0 0 8 8\" data-toggle=\"modal\" data-target=\"#deleteChannel\" data-whatever=\"@mdo\">\n                  <path d=\"M3 0c-.55 0-1 .45-1 1h-1c-.55 0-1 .45-1 1h7c0-.55-.45-1-1-1h-1c0-.55-.45-1-1-1h-1zm-2 3v4.81c0 .11.08.19.19.19h4.63c.11 0 .19-.08.19-.19v-4.81h-1v3.5c0 .28-.22.5-.5.5s-.5-.22-.5-.5v-3.5h-1v3.5c0 .28-.22.5-.5.5s-.5-.22-.5-.5v-3.5h-1z\" />            \n                  <title>Delete Channel</title>\n                </svg>\n            </div>\n           \n            : null\n          }\n          {channelExists \n            ? <Compose currentChannel={this.state.currentChannel} \n                        update={message => {this.update(message)}} \n                        currentUserFirstName={this.props.currentUserFirstName} \n                        currentUserLastName={this.props.currentUserLastName}\n                        />\n            : <h1>Create or Join Channel</h1>\n          }\n        </div>\n        <div>\n        <div class=\"signup-form\">\n            <div class=\"modal fade\" id=\"EditChannel\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"exampleModalLabel\" aria-hidden=\"true\">\n                <div class=\"modal-dialog\" role=\"document\">\n                    <form class=\"form-horizontal\">\n                        <div class=\"col-xs-8 col-xs-offset-4\">\n                            <h2>Edit Channel</h2>\n                        </div>\t\t\n                        <div class=\"form-group\">\n                            <label class=\"control-label col-xs-4\">Channel Name</label>\n                            <div class=\"col-xs-8\">\n                                <input type=\"text\" class=\"form-control\" name=\"edit_channel_name\" required=\"required\" placeholder={this.state.firstname}\n                                ref={node => (this.channelName = node)}\n                                />\n                            </div>        \t\n                        </div>\n                        <div class=\"form-group\">\n                            <label class=\"control-label col-xs-4\">Description</label>\n                            <div class=\"col-xs-8\">\n                                <input type=\"text\" class=\"form-control\" name=\"edit_channel_description\" placeholder={this.state.lastname}\n                                ref={node => (this.description = node)}\n                                />\n                            </div>        \t\n                        </div>\n                        {/* <div id =\"update-response\" class=\"text-center\">\n                            <p style={{color: this.state.color}}>{this.state.message}</p>\n                        </div> */}\n                        <div class=\"form-group\">\n                            <div class=\"col-xs-8 col-xs-offset-4\">\n                                <button class=\"btn btn-primary btn-sm\" onClick={(e) => {this.editChannel(e)}}>Save</button>\n                            </div>  \n                            <div class=\"col-xs-8 col-xs-offset-4\">\n                                <button type=\"button\" class=\"btn btn-primary btn-sm\" data-dismiss=\"modal\"\n                                >\n                                    Close</button>\n                            </div>  \n                        </div>\t\n                    </form>\n                </div>\n            </div>\n        </div>\n        <div class=\"signup-form\">\n            <div class=\"modal fade\" id=\"deleteChannel\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"exampleModalLabel\" aria-hidden=\"true\">\n                <div class=\"modal-dialog\" role=\"document\">\n                    <form class=\"form-horizontal\">\n                        <h2>Are you sure you want to delete this channel?</h2>\n                        <div class=\"form-group\">\n                            <div class=\"col-xs-8 col-xs-offset-4\">\n                                <button class=\"btn btn-primary btn-sm\" onClick={(e) => {this.deleteChannel(e)}}>YES</button>\n                            </div>  \n                            <div class=\"col-xs-8 col-xs-offset-4\">\n                                <button type=\"button\" class=\"btn btn-primary btn-sm\" data-dismiss=\"modal\"\n                                >\n                                    NO</button>\n                            </div>  \n                        </div>\t\n                    </form>\n                </div>\n            </div>\n        </div>\n        <div class=\"signup-form\">\n            <div class=\"modal fade\" id=\"AddToChannel\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"exampleModalLabel\" aria-hidden=\"true\">\n                <div class=\"modal-dialog\" role=\"document\">\n                    <form class=\"form-horizontal\">\n                        <div class=\"col-xs-8 col-xs-offset-4\">\n                            <h2>Add User to Channel</h2>\n                        </div>\t\t\n                        <div class=\"form-group\">\n                            <label class=\"control-label col-xs-4\">Username</label>\n                            <div class=\"col-xs-8\">\n                                <input type=\"text\" class=\"form-control\" name=\"edit_channel_name\" required=\"required\" placeholder={this.state.firstname}\n                                ref={node => (this.userName = node)}\n                                />\n                            </div>        \t\n                        </div>\n                        <div id =\"add-response\" class=\"text-center\">\n                            <p style={{color: this.state.color}}>{this.state.message}</p>\n                        </div>\n                        <div class=\"form-group\">\n                            <div class=\"col-xs-8 col-xs-offset-4\">\n                                <button class=\"btn btn-primary btn-sm\" onClick={(e) => {this.addUserToChannel(e)}}>Add</button>\n                            </div>  \n                            <div class=\"col-xs-8 col-xs-offset-4\">\n                                <button type=\"button\" class=\"btn btn-primary btn-sm\" data-dismiss=\"modal\" onClick={this.resetMessage}\n                                >\n                                    Close</button>\n                            </div>  \n                        </div>\t\n                    </form>\n                </div>\n            </div>\n        </div>\n        <div class=\"signup-form\">\n            <div class=\"modal fade\" id=\"removeFromChannel\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"exampleModalLabel\" aria-hidden=\"true\">\n                <div class=\"modal-dialog\" role=\"document\">\n                    <form class=\"form-horizontal\">\n                        <div class=\"col-xs-8 col-xs-offset-4\">\n                            <h2>Remove User From Channel</h2>\n                        </div>\t\t\n                        <div class=\"form-group\">\n                            <label class=\"control-label col-xs-4\">Username</label>\n                            <div class=\"col-xs-8\">\n                                <input type=\"text\" class=\"form-control\" name=\"edit_channel_name\" required=\"required\" placeholder={this.state.firstname}\n                                ref={node => (this.removeName = node)}\n                                />\n                            </div>        \t\n                        </div>\n                        <div id =\"remove-response\" class=\"text-center\">\n                            <p style={{color: this.state.color}}>{this.state.message}</p>\n                        </div>\n                        <div class=\"form-group\">\n                            <div class=\"col-xs-8 col-xs-offset-4\">\n                                <button class=\"btn btn-primary btn-sm\" onClick={(e) => {this.removeUserFromChannel(e)}}>Remove</button>\n                            </div>  \n                            <div class=\"col-xs-8 col-xs-offset-4\">\n                                <button type=\"button\" class=\"btn btn-primary btn-sm\" data-dismiss=\"modal\" onClick={this.resetMessage}\n                                >\n                                    Close</button>\n                            </div>  \n                        </div>\t\n                    </form>\n                </div>\n            </div>\n        </div>\n        </div>\n        <div className=\"message-list-container\">\n            {\n              this.renderMessages(this.state.messages)\n            }\n          </div>\n        <div style={{ float:\"left\", clear: \"both\" }}\n          ref={(el) => { this.messagesEnd = el; }}>\n        </div>\n      </div>\n    );\n  }\n}\n"]},"metadata":{},"sourceType":"module"}